import csv
import os
import statistics
import weighted  # your existing weighted.py module
import transform # select, project, sort, insert, delete

# ----------------------
# Configuration
# ----------------------
# File name for the CSV database
FILENAME = "ano.csv"

# Column names for the student data
HEADER = [
    "student_id",
    "last_name",
    "first_name",
    "section",
    "quiz1",
    "quiz2",
    "quiz3",
    "quiz4",
    "quiz5",
    "midterm",
    "final",
    "attendance_percent"
]





# ----------------------
# Main Menu
# ----------------------
def menu():
    """
    Main menu function that displays options and handles user choices.
    Runs in an infinite loop until user chooses to exit.
    """
    while True:
        # Display all menu options
        print("\n=== STUDENT CSV MENU ===")
        print("1. Add and Save Student(s)")
        print("2. Read CSV File")
        print("3. Delete Student by ID")
        print("4. Select Header column")
        print("5. Project Student Record by Student ID")
        print("6. Sort Student Data") # New option
        print("7. Analytics and Reports") # Shifted to 7
        print("8. Exit") # Shifted to 8

        # Get user input and remove extra spaces
        choice = input("Enter choice: ").strip()

        # Option 1: Add new student records to the CSV file
        if choice == "1":
            transform.add_data()
        
        # Option 2: Read and display all valid rows from CSV
        elif choice == "2":
            # clean_ingest() returns valid rows and invalid rows separately
            valid_rows, _ = transform.clean_ingest()
            if valid_rows:
                print("\nðŸ“˜ Valid rows:")
                for row in valid_rows:
                    print(row)
        
        # Option 3: Remove a student record by their ID
        elif choice == "3":
            transform.delete_data()
        
        # Option 4: Display a specific column from the data
        elif choice == "4":
            transform.select_column()
        
        # Option 5: Display a specific student's complete record
        elif choice == "5":
            transform.select_row()
        
        # Option 6: Sort the student data by a chosen field
        elif choice == "6":
            transform.sort_data()
        
        # Option 7: Analytics and reports submenu
        elif choice == "7":
            # Inner loop for analytics options
            while True:
                print("\n ANALYTICS MENU")
                print("a. Compute Weighted Grades")
                print("b. Grade Distribution (Aâ€“F)")
                print("c. Percentiles (Top/Bottom 10%)")
                print("d. Outlier Detection (Â±2 SD)")
                print("e. Improvement (Final vs Midterm)")
                print("f. Back to Main Menu")

                # Get submenu choice, convert to lowercase and trim spaces
                sub = input("Select an option (aâ€“f): ").lower().strip()

                # Call different analytics functions based on choice
                if sub == "a":
                    weighted.compute_grades()
                elif sub == "b":
                    weighted.grade_distribution()
                elif sub == "c":
                    weighted.percentiles()
                elif sub == "d":
                    weighted.outliers()
                elif sub == "e":
                    weighted.improvement()
                elif sub == "f":
                    break  # Exit analytics menu, return to main menu
                else:
                    print(" Invalid choice. Try again.")
        
        # Option 8: Exit the program completely
        elif choice == "8":
            print(" Exiting program.")
            break  # Exit the main loop, ending the program
        
        # Handle invalid menu choices
        else:
            print(" Invalid choice. Try again.")


# ----------------------
# Run Program
# ----------------------
# Start the program by calling the menu function
menu()
